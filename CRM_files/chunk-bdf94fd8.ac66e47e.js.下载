(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-bdf94fd8"],{1582:function(e,t,o){"use strict";o("5120")},"188c":function(e,t,o){},"24c0":function(e,t,o){},"2a4c":function(e,t,o){},4205:function(e,t,o){"use strict";o("188c")},5120:function(e,t,o){},"8fa3":function(e,t,o){"use strict";var a=function(){var e=this,t=e.$createElement,o=e._self._c||t;return e.visible?o("div",[o("a-drawer",{staticClass:"xf-drawer drawer",attrs:{title:"客诉单",closable:!0,visible:e.visible,width:"851",destroyOnClose:!0,"get-container":!1},on:{close:e.onClose}},[o("a-spin",{attrs:{spinning:e.loading}},[e.visible&&!e.loading?o("div",[e.jobStatus||e.operateStatus?e._e():[o("SectionTemplate",{attrs:{sectionTitle:"客诉信息"}},[o("kesuBaseifoForm",{ref:"baseinfoForm",attrs:{baseInfo:e.baseJobInfo,baseJobform:e.baseJobform,tabName:"创建",isEntry:e.dataSource.entry?e.dataSource.entry:null},on:{getOrder:e.getOrder}})],1),1===e.baseJobform.allotType?[o("SectionTemplate",{staticClass:"borderLine",attrs:{sectionTitle:"客诉分类"}},[o("kesuFenleiForm",{ref:"classifyForm",attrs:{classifyData:e.classifyData,classifyFormData:e.classifyFormData}})],1),o("SectionTemplate",{staticClass:"borderLine",attrs:{sectionTitle:"客诉结果"}},[o("kesuForm",{ref:"resultInfoForm",attrs:{resultInfo:e.resultInfo,resultInfoForm:e.resultInfoForm}})],1)]:e._e(),o("drawer-footer",{staticClass:"footer-box",attrs:{dataSource:e.dataSource,loading:e.saveLoading},on:{handleCancle:e.onClose,handleSave:e.handleSubmit}})],"WAIT_ALLOCATION"===e.operateStatus?[o("status-bar",{attrs:{jobStatus:e.operateStatus,visiblebtn:!0},on:{closeDrawer:e.onClose}}),o("SectionTemplate",{attrs:{sectionTitle:"客诉信息"}},[e.editOption&&"WAIT_ALLOCATION"===e.jobStatus?o("kesuBaseifoForm",{ref:"baseinfoForm",attrs:{baseInfo:e.baseJobInfo,baseJobform:e.baseJobform,tabName:"待处理",isEntry:e.dataSource.entry?e.dataSource.entry:null},on:{getOrder:e.getOrder}}):o("cantEditInfo",{attrs:{data:e.cantEditBaseInfoData},on:{getOrder:e.getOrder}})],1),o("drawer-footer",{staticClass:"footer-box",attrs:{dataSource:e.dataSource,isShowSave:e.editOption,loading:e.saveLoading,btns:{cancleBtn:!0,saveBtn:e.editOption&&"WAIT_ALLOCATION"===e.jobStatus,continueBtn:!1}},on:{handleCancle:e.onClose,handleSave:e.handleSubmit}})]:e._e(),"WAIT_HANDLER"===e.operateStatus||"CONDUCT_HANDLER"===e.operateStatus?[o("status-bar",{attrs:{jobStatus:e.operateStatus,visiblebtn:!0},on:{closeDrawer:e.onClose}}),o("SectionTemplate",{attrs:{sectionTitle:"客诉信息"}},[o("cantEditInfo",{attrs:{data:e.cantEditBaseInfoData},on:{getOrder:e.getOrder}})],1),e.followUp?o("div",[o("SectionTemplate",{staticClass:"borderLine",attrs:{sectionTitle:"客诉分类"}},[o("kesuFenleiForm",{ref:"classifyForm",attrs:{classifyData:e.classifyData,classifyFormData:e.classifyFormData}})],1),o("SectionTemplate",{staticClass:"borderLine",attrs:{sectionTitle:"客诉结果"}},[o("kesuForm",{ref:"resultInfoForm",attrs:{resultInfo:e.resultInfo,resultInfoForm:e.resultInfoForm}})],1)],1):e._e(),e.history&&e.history.length>0?o("SectionTemplate",{staticClass:"historyBox",attrs:{sectionTitle:"历史记录",collapse:e.isHistoryShow},on:{handleToggle:e.historyUpDown}},[o("timeline",{directives:[{name:"show",rawName:"v-show",value:e.isHistoryShow,expression:"isHistoryShow"}],attrs:{jobStatus:e.jobStatus,dataSource:e.dataSource,history:e.history}})],1):e._e(),o("drawer-footer",{staticClass:"footer-box",attrs:{isShowSave:e.editOption,dataSource:e.dataSource,loading:e.saveLoading,btns:{cancleBtn:!0,saveBtn:e.followUp,continueBtn:!1}},on:{handleCancle:e.onClose,handleSave:e.handleSubmit}})]:e._e(),"TEMPORARY_WAIT"===e.operateStatus?[o("status-bar",{attrs:{jobStatus:e.operateStatus,visiblebtn:!0},on:{closeDrawer:e.onClose}}),o("SectionTemplate",{attrs:{sectionTitle:"客诉信息"}},[o("cantEditInfo",{attrs:{data:e.cantEditBaseInfoData},on:{getOrder:e.getOrder}})],1),o("SectionTemplate",{staticClass:"borderLine",attrs:{sectionTitle:"客诉分类"}},[o("cantEditInfo",{attrs:{data:e.cantEditTypeData}})],1),e.history.length>0?o("SectionTemplate",{staticClass:"historyBox",attrs:{sectionTitle:"历史记录",collapse:e.isHistoryShow},on:{handleToggle:e.historyUpDown}},[o("timeline",{directives:[{name:"show",rawName:"v-show",value:e.isHistoryShow,expression:"isHistoryShow"}],attrs:{dataSource:e.dataSource,jobStatus:e.jobStatus,history:e.history},on:{continuehandle:e.continuehandle}})],1):e._e(),o("drawer-footer",{staticClass:"footer-box",attrs:{dataSource:e.dataSource,loading:e.saveLoading,btns:{cancleBtn:!1,saveBtn:!1,continueBtn:!0}},on:{handleCancle:e.onClose,handleSave:e.handleSubmit,continuehandle:e.continuehandle}})]:e._e(),"COMPLETED"===e.operateStatus?[o("status-bar",{attrs:{jobStatus:e.operateStatus},on:{closeDrawer:e.onClose}}),o("SectionTemplate",{attrs:{sectionTitle:"客诉信息"}},[o("cantEditInfo",{attrs:{data:e.cantEditBaseInfoData},on:{getOrder:e.getOrder}})],1),o("SectionTemplate",{staticClass:"borderLine",attrs:{sectionTitle:"客诉分类"}},[o("cantEditInfo",{attrs:{data:e.cantEditTypeData}})],1),e.history.length>0?o("SectionTemplate",{staticClass:"historyBox",attrs:{sectionTitle:"历史记录",collapse:e.isHistoryShow,iconHide:!1},on:{handleToggle:e.historyUpDown}},[o("timeline",{attrs:{dataSource:e.dataSource,history:e.history}})],1):e._e()]:e._e(),"CANCELLED"===e.operateStatus?[o("status-bar",{attrs:{jobStatus:e.operateStatus},on:{closeDrawer:e.onClose}}),o("SectionTemplate",{attrs:{sectionTitle:"客诉信息"}},[o("cantEditInfo",{attrs:{data:e.cantEditBaseInfoData},on:{getOrder:e.getOrder}})],1)]:e._e()],2):e._e()])],1),e.compensa?o("OrderDrawer",{attrs:{drawerShow:e.compensa,type:e.ordertype},on:{closecompensation:e.closecompensation}}):e._e(),o("drawerEmpty",{ref:"drawerEmpty",attrs:{width:1060,wxIframeSrc:e.wxIframeSrc},on:{wxiframeLoad:e.wxiframeLoad}})],1):e._e()},n=[],r=(o("99af"),o("4160"),o("b0c0"),o("159b"),o("96cf"),o("1da1")),i=o("5530"),s=o("c1df"),c=o.n(s),l=o("2af4"),u=o("9c7e"),m=o("d684"),d=o("5a55"),f=o("12c8"),p=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("a-form-model",{ref:"ruleForm",staticClass:"model",attrs:{model:e.baseJobform,rules:e.rules}},[o("a-form-model-item",{ref:"createTime",attrs:{label:"工单创建时间",prop:"createTime"}},[o("span",{staticClass:"ant-form-text"},[e._v(e._s(e.baseInfo.createTime?e.baseInfo.createTime:e.createTime))])]),o("a-form-model-item",{ref:"createPerson",attrs:{label:"工单创建人",prop:"createPerson"}},[o("span",{staticClass:"ant-form-text"},[e._v(e._s(e.baseInfo.creatorName))])]),o("a-form-model-item",{ref:"baseInfo",attrs:{label:"学员姓名",prop:"studentName"}},[o("span",{staticClass:"ant-form-text"},[e._v(e._s(e.baseInfo.studentName))])]),o("a-form-model-item",{ref:"phoneNumber",attrs:{label:"手机号码",prop:"phoneNumber"}},[o("span",{staticClass:"ant-form-text"},[o("span",{staticStyle:{"margin-right":"12px"}},[e._v(e._s(e.baseInfo.mobile))]),e.baseInfo.mobile?o("iconTel",{attrs:{phoneNumber:e.baseInfo.mobile,studentId:e.baseInfo.studentId}}):e._e(),e.baseInfo.mobile&&1===e.mobileCopy?o("a-icon",{staticStyle:{color:"#2c80ff","font-size":"22px"},attrs:{type:"copy"},on:{click:function(t){return t.stopPropagation(),e.entityCopy(t)}}}):e._e()],1)]),o("a-form-model-item",{ref:"gongdanID",attrs:{label:"订单ID",prop:"gongdanID"}},[o("span",{staticClass:"ant-form-text link_text",on:{click:e.getOrder}},[e._v(e._s(e.baseInfo.orderId))])]),o("a-form-model-item"),o("a-form-model-item",{ref:"complaintDate",attrs:{label:"投诉日期",prop:"complaintDate",autoLink:!1}},[o("a-date-picker",{staticStyle:{width:"238px"},attrs:{format:"YYYY-MM-DD ","disabled-date":e.disabledDate,getCalendarContainer:e.getCalendarContainer()},on:{change:e.onDateChange},model:{value:e.baseJobform.complaintDate,callback:function(t){e.$set(e.baseJobform,"complaintDate",t)},expression:"baseJobform.complaintDate"}})],1),o("a-form-model-item",{ref:"complaintCycle",attrs:{label:"投诉周期",prop:"complaintCycle"}},[o("span",{staticClass:"ant-form-text"},[e._v(e._s(e.baseJobform.complaintCycle?e.baseJobform.complaintCycle:0)+"天")])]),o("a-form-model-item",{ref:"complaintContent",attrs:{label:"投诉内容",prop:"complaintContent"}},[o("a-textarea",{staticStyle:{width:"238px",height:"60px",maxHeight:"60px"},attrs:{placeholder:"请输入投诉内容"},model:{value:e.baseJobform.complaintContent,callback:function(t){e.$set(e.baseJobform,"complaintContent",t)},expression:"baseJobform.complaintContent"}})],1),o("a-form-model-item",{ref:"communicationWay",attrs:{label:"沟通方式",prop:"communicationWay"}},[o("a-select",{staticStyle:{width:"238px"},attrs:{placeholder:"请选择",getPopupContainer:e.getCalendarContainer(),allowClear:""},model:{value:e.baseJobform.communicationWay,callback:function(t){e.$set(e.baseJobform,"communicationWay",t)},expression:"baseJobform.communicationWay"}},e._l(e.communicationWayOption,(function(t,a){return o("a-select-option",{key:a,attrs:{value:t.value}},[e._v(e._s(t.text))])})),1)],1),"PHONE"===e.baseJobform.communicationWay?o("a-form-model-item",{ref:"phoneRecordingVo",attrs:{label:"电话录音",prop:"phoneRecordingVo"}},[o("a-select",{staticStyle:{width:"238px"},attrs:{defaultValue:e.phoneRecordingVoId,getPopupContainer:e.getCalendarContainer(),placeholder:"请选择",allowClear:""},on:{change:e.onChange}},e._l(e.phoneRecordingVoOptions,(function(t){return o("a-select-option",{key:t.sheetId,attrs:{title:t.ringTime+" "+t.callSeconds+" 秒",value:t.sheetId}},[e._v(e._s(t.ringTime)+" "+e._s(t.callSeconds)+" 秒")])})),1)],1):e._e(),o("a-form-model-item",{ref:"communicationProof",attrs:{label:"沟通凭证",prop:"communicationProof"}},[o("UploadFile",{staticStyle:{"max-width":"240px"},attrs:{showLabel:"",disabled:!0,code:"communicationProof",maxLength:5},on:{input:e.uploadChange},model:{value:e.baseJobform.communicationProof,callback:function(t){e.$set(e.baseJobform,"communicationProof",t)},expression:"baseJobform.communicationProof"}},[o("a",{staticClass:"uploadBtn"},[e._v("+上传附件")])])],1),"创建"===e.tabName&&this.radios&&this.radios.length>0?o("a-form-model-item",{ref:"allotType",staticClass:"allline",attrs:{label:"客诉分配",prop:"allotType"}},[o("a-radio-group",{staticClass:"radioGroup",attrs:{name:"allotType",defaultValue:e.radios[0].value},on:{change:e.allotChange},model:{value:e.baseJobform.allotType,callback:function(t){e.$set(e.baseJobform,"allotType",t)},expression:"baseJobform.allotType"}},e._l(e.radios,(function(t,a){return o("a-radio",{key:a,attrs:{value:t.value}},[e._v(e._s(t.text))])})),1)],1):e._e(),e.baseJobform.allotType&&0!==e.baseJobform.allotType?o("a-form-model-item",{ref:"processor",attrs:{label:"客诉处理人",prop:"processor"}},[1===e.baseJobform.allotType?o("span",[e._v(e._s(e.baseInfo.creatorName))]):2!==e.baseJobform.allotType||null!==e.status&&"WAIT_ALLOCATION"!==e.status&&"WAIT_HANDLER"!==e.status?e._e():o("a-select",{staticStyle:{width:"238px"},attrs:{"show-search":"","option-filter-prop":"children","filter-option":e.filterOption,allowClear:"",getPopupContainer:e.getCalendarContainer(),placeholder:"请选择"},model:{value:e.baseJobform.processor,callback:function(t){e.$set(e.baseJobform,"processor",t)},expression:"baseJobform.processor"}},e._l(e.processorOptions,(function(t){return o("a-select-option",{key:t.id,attrs:{value:t.id,title:t.name}},[e._v(e._s(t.name))])})),1)],1):e._e(),e._l(e.customList,(function(t,a){return o("a-form-model-item",{key:a,ref:t.code,refInFor:!0,attrs:{label:t.name,prop:t.code}},["SELECT"===t.type?o("a-select",{staticStyle:{width:"238px"},attrs:{getPopupContainer:e.getCalendarContainer(),placeholder:"请选择",allowClear:""},model:{value:e.baseJobform[t.code],callback:function(o){e.$set(e.baseJobform,t.code,o)},expression:"baseJobform[item.code]"}},e._l(JSON.parse(t.value),(function(t,a){return o("a-select-option",{key:a,attrs:{value:t.value,title:t.text}},[e._v(e._s(t.text))])})),1):e._e(),"TEXTAREA"===t.type?o("a-textarea",{staticStyle:{width:"238px",height:"60px",maxHeight:"60px"},attrs:{placeholder:"请输入"},model:{value:e.baseJobform[t.code],callback:function(o){e.$set(e.baseJobform,t.code,o)},expression:"baseJobform[item.code]"}}):e._e()],1)}))],2)},h=[],b=(o("4de4"),o("caad"),o("c975"),o("d81d"),o("ac1f"),o("2532"),o("1276"),o("b563")),g=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"communicate_box"},["投诉内容"===e.communicationInfoLabel?o("a-form-model-item",{ref:"complaintContent",attrs:{label:e.communicationInfoLabel,prop:"complaintContent"}},[o("a-textarea",{staticStyle:{width:"238px",height:"60px",maxHeight:"60px"},attrs:{placeholder:"请输入"+e.communicationInfoLabel},model:{value:e.propsform.complaintContent,callback:function(t){e.$set(e.propsform,"complaintContent",t)},expression:"propsform.complaintContent"}})],1):"沟通内容"===e.communicationInfoLabel?o("a-form-model-item",{ref:"communicationInfo",attrs:{label:e.communicationInfoLabel,prop:"communicationInfo"}},[o("a-textarea",{staticStyle:{width:"238px",height:"60px",maxHeight:"60px"},attrs:{placeholder:"请输入"+e.communicationInfoLabel},model:{value:e.propsform.communicationInfo,callback:function(t){e.$set(e.propsform,"communicationInfo",t)},expression:"propsform.communicationInfo"}})],1):e._e(),o("a-form-model-item",{ref:"communicationWay",attrs:{label:"沟通方式",prop:"communicationWay"}},[o("a-select",{staticStyle:{width:"238px"},attrs:{placeholder:"请选择",getPopupContainer:e.getCalendarContainer()},model:{value:e.propsform.communicationWay,callback:function(t){e.$set(e.propsform,"communicationWay",t)},expression:"propsform.communicationWay"}},e._l(e.communicationWayOption,(function(t,a){return o("a-select-option",{key:a,attrs:{value:t.value}},[e._v(e._s(t.text))])})),1)],1),"PHONE"===e.propsform.communicationWay?o("a-form-model-item",{ref:"phoneRecordingVo",attrs:{label:"电话录音",prop:"phoneRecordingVo"}},[o("a-select",{staticStyle:{width:"238px"},attrs:{defaultValue:e.phoneRecordingVoId,getPopupContainer:e.getCalendarContainer(),placeholder:"请选择"},on:{change:e.onChange}},e._l(e.phoneRecordingVoOptions,(function(t){return o("a-select-option",{key:t.sheetId,attrs:{title:t.ringTime+" "+t.callSeconds+" 秒",value:t.sheetId}},[e._v(e._s(t.ringTime)+" "+e._s(t.callSeconds)+" 秒")])})),1)],1):e._e(),o("a-form-model-item",{ref:"communicationProof",attrs:{label:"沟通凭证",prop:"communicationProof"}},[o("UploadFile",{staticStyle:{"max-width":"240px"},attrs:{showLabel:"",disabled:!0,code:"communicationProof",maxLength:5},on:{input:e.uploadChange},model:{value:e.propsform.communicationProof,callback:function(t){e.$set(e.propsform,"communicationProof",t)},expression:"propsform.communicationProof"}},[o("a",{staticClass:"uploadBtn"},[e._v("+上传附件")])])],1)],1)},I=[],y=o("5f39"),v=o("803f"),C=o("5880"),S={components:{UploadFile:y["a"]},props:{propsform:{type:Object,require:!0,default:function(){return{}}},communicationInfoLabel:{default:"沟通内容",required:!1,type:String},formList:{type:Array,require:!0,default:function(){return[]}},studentId:{type:String,default:"",required:!1}},data:function(){return{visible_communicateModal:!1,phoneRecordingVoOptions:[],phoneRecord:{}}},computed:Object(i["a"])(Object(i["a"])({},Object(C["mapGetters"])(["currentJobInfo","currentStudentInfo"])),{},{communicationWayOption:function(){var e;return this.formList.forEach((function(t){"communicationWay"===t.code&&(e=JSON.parse(t.value))})),e},phoneRecordingVoId:function(){return this.propsform&&this.propsform.phoneRecordingVo&&this.propsform.phoneRecordingVo.recordingId}}),mounted:function(){this.init()},watch:{formList:function(e){this.init()}},methods:{onChange:function(e){var t={};this.phoneRecordingVoOptions.forEach((function(o){o.sheetId===e&&(t.duration=o.duration,t.recordingId=o.sheetId,t.url=o.fileUrl)})),this.phoneRecord=t,this.$set(this.propsform,"phoneRecordingVo",t)},getCalendarContainer:function(){return function(e){return e.parentNode}},init:function(){var e=this,t=this.currentJobInfo.studentId,o=this.currentJobInfo&&this.currentJobInfo.jobInfo&&this.currentJobInfo.jobInfo.userName;Object(v["n"])({size:0,current:0,sale:o,studentId:t}).then((function(t){t&&200===t.code&&(e.phoneRecordingVoOptions=t.data.list||[])}))},uploadChange:function(e,t){var o=[];e.forEach((function(e){o.push({duration:null,name:e.name,size:e.size?e.size:null,type:e.type?e.type:null,url:e.key})})),this.$set(this.propsform,"communicationProof",e),this.$set(this.propsform,"resourceList",o)},showModal:function(){this.visible_communicateModal=!0},closeModal:function(){this.visible_communicateModal=!1}}},O=S,T=(o("9d12"),o("0c7c")),F=Object(T["a"])(O,g,I,!1,null,"7d2697c9",null),w=F.exports,x=o("a2cb"),_=o("e0a6"),J=o("ca00"),D=o("960c"),E={components:{communicate:w,iconTel:_["a"],customFiled:x["a"],UploadFile:y["a"]},mixins:[b["a"]],props:{baseInfo:{type:Object,default:function(){return{}},required:!0},baseJobform:{type:Object,default:function(){return{}},required:!0},tabName:{type:String,default:"",required:!1},isEntry:{type:String,default:"",required:!1}},watch:{baseInfo:function(e){this.initData()}},computed:Object(i["a"])(Object(i["a"])({},Object(C["mapGetters"])(["currentJobInfo","currentStudentInfo"])),{},{customList:function(){return this.baseInfo&&this.baseInfo.JobInfoArr&&this.baseInfo.JobInfoArr.filter((function(e){return"CUSTOM"===e.cate}))},phoneRecordingVoId:function(){return this.baseJobform&&this.baseJobform.phoneRecordingVo&&this.baseJobform.phoneRecordingVo.recordingId},communicationWayOption:function(){var e;return this.baseInfo&&this.baseInfo.JobInfoArr&&this.baseInfo.JobInfoArr.forEach((function(t){"communicationWay"===t.code&&(e=JSON.parse(t.value))})),e}}),data:function(){return{rules:{processor:[{required:!0,message:"必填项",trigger:"change"}],complaintDate:[{required:!0,message:"必填项",trigger:"change"}],complaintContent:[{required:!0,message:"必填项",trigger:"change"}],delayReason:[{required:!0,message:"必填项",trigger:"change"}],lastHandleTime:[{required:!0,message:"必填项",trigger:"change"}],followPlan:[{required:!0,message:"必填项",trigger:"change"}],gongdanType:[{required:!0,message:"必填项",trigger:"change"}],remarks:[{required:!0,message:"必填项",trigger:"change"}],allotType:[{required:!0,message:"必填项",trigger:"change"}]},createTime:c()().format("YYYY-MM-DD HH:mm:ss"),processorOptions:[],radios:[],status:null,customFrom:null,mobileCopy:!1,phoneRecordingVoOptions:[]}},methods:{entityCopy:function(e){var t=this;Object(D["h"])({code:"mobile",studentId:this.baseInfo.studentId}).then((function(e){200===e.code?t.$copyText(e.data).then((function(e){t.$toast("复制成功！")})):t.$toast("复制失败，请重试！")})).catch((function(e){}))},getOrder:function(){this.$emit("getOrder")},getCalendarContainer:function(){return function(e){return e.parentNode}},initData:function(){var e=this;this.baseInfo&&this.baseInfo.JobInfoArr&&(this.baseInfo.JobInfoArr.forEach((function(t){e.$set(e.rules,t.code,[{required:t.padding,message:"必填项",trigger:"change"}])})),this.customFrom=this.baseInfo.JobInfoArr.filter((function(e){return"CUSTOM"===e.cate})),this.customFrom.forEach((function(t){e.$set(e.baseJobform,t.code,t.defaultValue||void 0)})));var t=this.baseInfo.encryptFileds,o=t&&t.mobile;this.mobileCopy=o,this.getAllotType();var a=this.currentJobInfo&&this.currentJobInfo.jobInfo&&this.currentJobInfo.jobInfo.studentId,n=this.currentJobInfo&&this.currentJobInfo.jobInfo&&this.currentJobInfo.jobInfo.userId,r=this.currentJobInfo&&this.currentJobInfo.jobInfo&&this.currentJobInfo.jobInfo.mobile;this.isEntry&&"CRM"===this.isEntry?Object(v["m"])({phoneNum:r,sale:n}).then((function(t){t&&200===t.code&&(e.phoneRecordingVoOptions=t.data)})):Object(v["n"])({size:0,current:0,sale:n,studentId:a}).then((function(t){t&&200===t.code&&(e.phoneRecordingVoOptions=t.data.list||[])}))},getAllotType:function(){var e=this;Object(D["e"])({type:"CUSTOMER_COMPLAINT"}).then((function(t){if(200===t.code){var o=t.data||[];e.radios=o.map((function(t){var o={};return"NOT_ALLOCATION"===t&&(o.value=0,o.text="不分配",o.string="NOT_ALLOCATION"),"ALLOCATION_OWN"===t&&(o.value=1,o.text="分配给自己",o.string="ALLOCATION_OWN"),"APPOINT_ALLOCATION"===t&&(o.value=2,o.text="指定分配",o.string="APPOINT_ALLOCATION",e.getJobProcessor()),o})),e.$set(e.baseJobform,"allotType",e.radios[0].value),1===e.baseJobform.allotType?e.$set(e.baseJobform,"processor",e.baseInfo.creatorName):e.$set(e.baseJobform,"processor",void 0)}}))},filterOption:function(e,t){return t.componentOptions.children[0].text.toLowerCase().indexOf(e.toLowerCase())>=0},validateForm:function(){var e=null;return this.$refs.ruleForm.validate((function(t){e=!!t})),e},disabledDate:function(e){var t=this.baseInfo.followUpTime;return t&&t.includes(":")&&(t=t.split(" ")[0]+" 00:00:00"),e<c()(t).subtract(0,"day")||e>c()()},onDateChange:function(e,t){this.$refs.complaintDate.onFieldChange();var o=c()(this.baseInfo.followUpTime).format("YYYY-MM-DD");this.$set(this.baseJobform,"complaintCycle",Object(J["e"])(t,o))},allotChange:function(e){1===this.baseJobform.allotType?(this.$set(this.baseJobform,"processor",this.baseInfo.creatorName),this.$refs.processor.onFieldChange()):this.$set(this.baseJobform,"processor","")},getJobProcessor:function(){var e=this;Object(D["l"])({type:"CUSTOMER_COMPLAINT"}).then((function(t){t&&200===t.code&&(e.processorOptions=t.data||[])}))},onChange:function(e){var t={};this.phoneRecordingVoOptions.forEach((function(o){o.sheetId===e&&(t.duration=o.duration,t.recordingId=o.sheetId,t.url=o.fileUrl)})),this.phoneRecord=t,this.$set(this.baseJobform,"phoneRecordingVo",t)},uploadChange:function(e,t){var o=[];e.forEach((function(e){o.push({duration:null,name:e.name,size:e.size?e.size:null,type:e.type?e.type:null,url:e.key})})),this.$refs.communicationProof.onFieldChange(),this.$set(this.baseJobform,"resourceList",o)}},mounted:function(){this.initData()}},j=E,L=(o("b960"),Object(T["a"])(j,p,h,!1,null,"6b28e77a",null)),R=L.exports,N=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("a-form-model",{ref:"ruleForm",staticClass:"model",attrs:{model:e.resultInfoForm,rules:e.rules,"label-col":e.labelCol,"wrapper-col":e.wrapperCol}},[o("a-form-model-item",{ref:"handlePerson",attrs:{label:"处理人",prop:"handlePerson"}},[o("span",{staticClass:"ant-form-text"},[e._v(e._s(e.resultInfo&&e.resultInfo.userName))])]),o("a-form-model-item",{ref:"handleTime",attrs:{label:"处理时间",prop:"handleTime"}},[o("span",{staticClass:"ant-form-text"},[e._v(e._s(e.handleTime))])]),o("a-form-model-item",{ref:"communicationInfo",attrs:{label:"沟通内容",prop:"communicationInfo"}},[o("a-textarea",{staticStyle:{width:"238px",height:"60px",maxHeight:"60px"},attrs:{placeholder:"请输入沟通内容"},model:{value:e.resultInfoForm.communicationInfo,callback:function(t){e.$set(e.resultInfoForm,"communicationInfo",t)},expression:"resultInfoForm.communicationInfo"}})],1),o("a-form-model-item",{ref:"communicationWay",attrs:{label:"沟通方式",prop:"communicationWay"}},[o("a-select",{staticStyle:{width:"238px"},attrs:{placeholder:"请选择",getPopupContainer:e.getCalendarContainer(),allowClear:""},model:{value:e.resultInfoForm.communicationWay,callback:function(t){e.$set(e.resultInfoForm,"communicationWay",t)},expression:"resultInfoForm.communicationWay"}},e._l(e.communicationWayOption,(function(t,a){return o("a-select-option",{key:a,attrs:{value:t.value}},[e._v(e._s(t.text))])})),1)],1),"PHONE"===e.resultInfoForm.communicationWay?o("a-form-model-item",{ref:"phoneRecordingVo",attrs:{label:"电话录音",prop:"phoneRecordingVo"}},[o("a-select",{staticStyle:{width:"238px"},attrs:{defaultValue:e.phoneRecordingVoId,getPopupContainer:e.getCalendarContainer(),placeholder:"请选择",allowClear:""},on:{change:e.onChange}},e._l(e.phoneRecordingVoOptions,(function(t){return o("a-select-option",{key:t.sheetId,attrs:{title:t.ringTime+" "+t.callSeconds+" 秒",value:t.sheetId}},[e._v(e._s(t.ringTime)+" "+e._s(t.callSeconds)+" 秒")])})),1)],1):e._e(),o("a-form-model-item",{ref:"communicationProof",attrs:{label:"沟通凭证",prop:"communicationProof"}},[o("UploadFile",{staticStyle:{"max-width":"240px"},attrs:{showLabel:"",disabled:!0,code:"communicationProof",maxLength:5},on:{input:e.uploadChange},model:{value:e.resultInfoForm.communicationProof,callback:function(t){e.$set(e.resultInfoForm,"communicationProof",t)},expression:"resultInfoForm.communicationProof"}},[o("a",{staticClass:"uploadBtn"},[e._v("+上传附件")])])],1),o("a-form-model-item",{ref:"operateStatus",attrs:{label:"客诉单状态",prop:"operateStatus"}},[o("a-select",{staticStyle:{width:"238px"},attrs:{allowClear:"",getPopupContainer:e.getCalendarContainer(),placeholder:"请选择"},model:{value:e.resultInfoForm.operateStatus,callback:function(t){e.$set(e.resultInfoForm,"operateStatus",t)},expression:"resultInfoForm.operateStatus"}},[o("a-select-option",{attrs:{value:"CONDUCT_HANDLER"}},[e._v("处理中")]),o("a-select-option",{attrs:{value:"TEMPORARY_WAIT"}},[e._v("暂时搁置")]),o("a-select-option",{attrs:{value:"COMPLETED"}},[e._v("已完成")])],1)],1),"CONDUCT_HANDLER"===e.resultInfoForm.operateStatus?o("a-form-model-item",{ref:"nextPlanTime",attrs:{label:"下次跟进时间",prop:"nextPlanTime"}},[o("a-date-picker",{staticStyle:{width:"238px"},attrs:{format:"YYYY-MM-DD HH:mm:ss","show-time":{defaultValue:e.moment("00:00:00","HH:mm:ss")},"disabled-date":e.disabledDate,getCalendarContainer:e.getCalendarContainer()},model:{value:e.resultInfoForm.nextPlanTime,callback:function(t){e.$set(e.resultInfoForm,"nextPlanTime",t)},expression:"resultInfoForm.nextPlanTime"}})],1):e._e(),"COMPLETED"===e.resultInfoForm.operateStatus?o("a-form-model-item",{ref:"inspectionErrorResult",attrs:{label:"客诉处理结果",prop:"inspectionErrorResult"}},[o("a-select",{staticStyle:{width:"238px"},attrs:{allowClear:"",getPopupContainer:e.getCalendarContainer()},model:{value:e.resultInfoForm.inspectionErrorResult,callback:function(t){e.$set(e.resultInfoForm,"inspectionErrorResult",t)},expression:"resultInfoForm.inspectionErrorResult"}},[o("a-select-option",{attrs:{value:"0"}},[e._v("协商一致")]),o("a-select-option",{attrs:{value:"1"}},[e._v("退费")]),o("a-select-option",{attrs:{value:"2"}},[e._v("转班")])],1)],1):e._e(),e._l(e.customList,(function(t,a){return o("a-form-model-item",{key:a,ref:t.code,refInFor:!0,attrs:{label:t.name,prop:t.code}},["SELECT"===t.type?o("a-select",{staticStyle:{width:"238px"},attrs:{getPopupContainer:e.getCalendarContainer(),placeholder:"请选择",allowClear:""},model:{value:e.resultInfoForm[t.code],callback:function(o){e.$set(e.resultInfoForm,t.code,o)},expression:"resultInfoForm[item.code]"}},e._l(JSON.parse(t.value),(function(t,a){return o("a-select-option",{key:a,attrs:{value:t.value,title:t.text}},[e._v(e._s(t.text))])})),1):e._e(),"TEXTAREA"===t.type?o("a-textarea",{staticStyle:{width:"238px",height:"60px",maxHeight:"60px"},attrs:{placeholder:"请输入"},model:{value:e.resultInfoForm[t.code],callback:function(o){e.$set(e.resultInfoForm,t.code,o)},expression:"resultInfoForm[item.code]"}}):e._e()],1)}))],2)},A=[],P={components:{communicate:w,customFiled:x["a"],UploadFile:y["a"]},mixins:[b["a"]],props:{resultInfo:{type:Object,default:function(){return{}},required:!0},resultInfoForm:{type:Object,default:function(){return{}},required:!0}},data:function(){return{labelCol:{span:6},wrapperCol:{span:16},rules:{complaintContent:[{required:!0,message:"必填项",trigger:"change"}],communicationInfo:[{required:!0,message:"必填项",trigger:"change"}],inspectionErrorResult:[{required:!0,message:"必填项",trigger:"change"}],nextPlanTime:[{required:!0,message:"必填项",trigger:"change"}],operateStatus:[{required:!0,message:"必填项",trigger:"change"}]},handleTime:c()().format("YYYY-MM-DD HH:mm:ss"),realName:null,customFrom:null,phoneRecordingVoOptions:[],phoneRecord:{}}},methods:{getCalendarContainer:function(){return function(e){return e.parentNode}},disabledDate:function(e){return e<c()().subtract(1,"day")},validateForm:function(){var e=null;return this.$refs.ruleForm.validate((function(t){e=!!t})),e},init:function(){var e=this;this.resultInfo&&this.resultInfo.JobInfoArr&&this.resultInfo.JobInfoArr.length>0&&(this.resultInfo.JobInfoArr.forEach((function(t){e.$set(e.rules,t.code,[{required:!!t.padding,message:"必填项",trigger:["change","blur"]}])})),this.customFrom=this.resultInfo.JobInfoArr.filter((function(e){return"CUSTOM"===e.cate}))),this.customFrom.forEach((function(t){e.$set(e.resultInfoForm,t.code,t.defaultValue||void 0)}));var t=this.currentJobInfo&&this.currentJobInfo.jobInfo&&this.currentJobInfo.jobInfo.studentId,o=this.currentJobInfo&&this.currentJobInfo.jobInfo&&this.currentJobInfo.jobInfo.userId;Object(v["n"])({size:0,current:0,sale:o,studentId:t}).then((function(t){t&&200===t.code&&(e.phoneRecordingVoOptions=t.data.list||[])}))},onChange:function(e){var t={};this.phoneRecordingVoOptions.forEach((function(o){o.sheetId===e&&(t.duration=o.duration,t.recordingId=o.sheetId,t.url=o.fileUrl)})),this.phoneRecord=t,this.$set(this.resultInfoForm,"phoneRecordingVo",t)},uploadChange:function(e,t){var o=[];e.forEach((function(e){o.push({duration:null,name:e.name,size:e.size?e.size:null,type:e.type?e.type:null,url:e.key})})),this.$set(this.resultInfoForm,"communicationProof",e),this.$set(this.resultInfoForm,"resourceList",o)}},watch:{resultInfo:function(e,t){e&&this.init()}},computed:Object(i["a"])(Object(i["a"])({},Object(C["mapGetters"])(["currentJobInfo","currentStudentInfo"])),{},{customList:function(){return this.resultInfo.JobInfoArr.filter((function(e){return"CUSTOM"===e.cate}))},phoneRecordingVoId:function(){return this.resultInfoForm&&this.resultInfoForm.phoneRecordingVo&&this.resultInfoForm.phoneRecordingVo.recordingId},communicationWayOption:function(){var e;return this.resultInfo.JobInfoArr.forEach((function(t){"communicationWay"===t.code&&(e=JSON.parse(t.value))})),e}}),mounted:function(){this.init()}},M=P,$=(o("4205"),Object(T["a"])(M,N,A,!1,null,"186b68e4",null)),k=$.exports,V=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("a-form-model",{ref:"ruleForm",staticClass:"model",attrs:{model:e.classifyFormData,rules:e.rules,"label-col":e.labelCol,"wrapper-col":e.wrapperCol}},[e.classifyData.complaintSource?o("a-form-model-item",{ref:"complaintSource",attrs:{label:"投诉来源",prop:"complaintSource",placeholder:"请选择"}},[o("a-select",{staticStyle:{width:"238px"},attrs:{allowClear:"",placeholder:"请选择",getPopupContainer:e.getCalendarContainer()},model:{value:e.classifyFormData.complaintSource,callback:function(t){e.$set(e.classifyFormData,"complaintSource",t)},expression:"classifyFormData.complaintSource"}},e._l(e.classifyData.complaintSource,(function(t,a){return o("a-select-option",{key:a,attrs:{value:t.value,title:t.text}},[e._v(e._s(t.text))])})),1)],1):e._e(),e.classifyData.complaintAscription?o("a-form-model-item",{ref:"complaintAscription",attrs:{label:"投诉归类",prop:"complaintAscription",placeholder:"请选择"}},[o("a-select",{staticStyle:{width:"238px"},attrs:{allowClear:"",placeholder:"请选择",getPopupContainer:e.getCalendarContainer()},model:{value:e.classifyFormData.complaintAscription,callback:function(t){e.$set(e.classifyFormData,"complaintAscription",t)},expression:"classifyFormData.complaintAscription"}},e._l(e.classifyData.complaintAscription,(function(t,a){return o("a-select-option",{key:a,attrs:{value:t.value,title:t.text}},[e._v(e._s(t.text))])})),1)],1):e._e()],1)},W=[],H={data:function(){return{labelCol:{span:6},wrapperCol:{span:16},rules:{complaintSource:[{required:!0,message:"必填项",trigger:"change"}],complaintAscription:[{required:!0,message:"必填项",trigger:"change"}]}}},props:{classifyData:{type:Object,default:function(){return{}},required:!0},classifyFormData:{type:Object,default:function(){return{}},required:!0}},methods:{getCalendarContainer:function(){return function(e){return e.parentNode}},validateForm:function(){var e=null;return this.$refs.ruleForm.validate((function(t){e=!!t})),e}}},U=H,Y=(o("1582"),Object(T["a"])(U,V,W,!1,null,"b91d67f4",null)),q=Y.exports,B=(o("a434"),o("2909"));function z(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.jobConfigRelationFieldVoList,o=void 0===t?[]:t,a=e.jobInfo,n=void 0===a?{}:a,r=e.jobModelComplaintVo,s=void 0===r?{}:r,c=e.jobModelFieldConfigVoList,l=void 0===c?[]:c,u=e.jobModelInspectionVoList,m=void 0===u?[]:u,d=e.type,f=void 0===d?"":d;function p(e){var t=[];o&&o.forEach((function(o){o.jobModel===e&&t.push(o)})),t.sort((function(e,t){return e.sort-t.sort}));var a=[];return t.forEach((function(e){var t,o=!1;l.forEach((function(a){e.tableFieldConfigId===a.id&&(o=!0,t=a)})),o&&a.push(Object(i["a"])(Object(i["a"])({},t),{},{padding:e.padding})),o=!1})),a}function h(){var e=[],t=n,o=t.createTime,a=t.creatorName,r=t.orderId,c=t.mobile,l=t.studentName,u=t.ownName;if("CUSTOMER_COMPLAINT"===f){var m=s,d=m.communicationWay,h=m.complaintContent,b=m.complaintCycle,g=m.complaintDate,I=m.phoneRecordingVo,y=m.resourceList;e=[{name:"工单创建时间",value:o,code:"createTime"},{name:"工单创建人",value:a,code:"creatorName"},{name:"学员姓名",value:l,code:"studentName"},{name:"手机号码",value:c,code:"mobile"},{name:"订单ID",value:r,code:"orderId"},{name:"投诉日期",value:g,code:"complaintDate"},{name:"投诉周期",value:b?b+"天":"0天",code:"complaintCycle"},{name:"投诉内容",value:h,code:"complaintContent"},{name:"沟通方式",value:d,code:"communicationWay"},{name:"电话录音",value:I||"",code:"phoneRecordingVo",showFlag:"PHONE"===d?1:0},{name:"沟通凭证",value:y,code:"resourceList"},{name:"客诉处理人",value:u,code:"ownName"}]}var v=p("JOB_INFO"),C=[];v.forEach((function(e){"CUSTOM"===e.cate&&C.push(Object(i["a"])(Object(i["a"])({},e),{},{name:e.name,value:s[e.code],code:e.code,showFlag:!0}))}));for(var S=0;S<e.length;S++)0===e[S].showFlag&&e.splice(S,1);return e=[].concat(Object(B["a"])(e),C),e}function b(e){var t=[],o=[];return"CUSTOMER_COMPLAINT"===f&&(o=s&&s.jobModelComplaintResultVoList||[]),o.forEach((function(o){var a=o.communicationInfo,n=o.communicationWay,r=o.nextPlanTime,i=o.phoneRecordingVo,s=o.processTime,c=o.processorName,l=o.inspectionErrorResult,u=o.resourceList,m=o.operateStatus,d=o.jobModelModifyLogVo,f=d||{},h=[{name:"处理人",value:c,code:"processorName",showFlag:!0},{name:"处理时间",value:s,code:"processTime",showFlag:!0},{name:"沟通内容",value:a,code:"communicationInfo",showFlag:!0},{name:"沟通方式",value:n,code:"communicationWay",showFlag:!0},{name:"电话录音",value:i||"",code:"phoneRecordingVo",showFlag:!1},{name:"沟通凭证",value:u,code:"resourceList",showFlag:!0},{name:"客诉单状态",value:m,code:"operateStatus",showFlag:!0},{name:"下次跟进时间",value:r,code:"nextPlanTime",showFlag:!0},{name:"客诉处理结果",value:l,code:"inspectionErrorResult",showFlag:!1}];"COMPLETED"===m&&h.forEach((function(e){"nextPlanTime"===e.code?e.showFlag=!1:"inspectionErrorResult"===e.code&&(e.showFlag=!0)})),"TEMPORARY_WAIT"===m&&h.forEach((function(e){("nextPlanTime"===e.code||"inspectionErrorResult"===e.code)&&(e.showFlag=!1)})),"PHONE"===n&&h.forEach((function(e){"phoneRecordingVo"===e.code&&(e.showFlag=!0)}));var b=p(e);b.forEach((function(e){"CUSTOM"===e.cate&&h.push({name:e.name,value:o[e.code],showFlag:!0})})),h=h.filter((function(e){return e.showFlag})),t.push({name:"",operateStatus:m,dataSource:h,reEditRecord:f||{}})})),t}function g(){var e=[],t=m||[];return t.forEach((function(t){var o=t.communicationInfo,a=t.communicationWay,n=t.inspectionErrorResult,r=t.inspectionRecognize,i=t.phoneRecordingVo,s=t.processTime,c=t.processor,l=t.resourceList,u=t.status,m=t.type,d=t.nextPlanTime,f=[];0===m&&(f=[{name:"处理时间",value:s,code:"processTime",showFlag:!0},{name:"处理人",value:c,code:"processor",showFlag:!0},{name:"质检认定",value:r,code:"inspectionRecognize",showFlag:!1},{name:"工单状态",value:u,code:"status",showFlag:!0},{name:"异常处理结果",value:n,code:"inspectionErrorResult",showFlag:!1},{name:"沟通内容",value:o,code:"communicationInfo",showFlag:!0},{name:"沟通方式",value:a,code:"communicationWay",showFlag:!0},{name:"聊天记录",value:i,code:"phoneRecordingVo",showFlag:!1},{name:"沟通凭证",value:l,code:"resourceList",showFlag:!0},{name:"下次跟进时间",value:d,code:"nextPlanTime",showFlag:!1}]),1===m&&(f=[{name:"处理时间",value:s,code:"processTime",showFlag:!0},{name:"处理人",value:c,code:"processor",showFlag:!0},{name:"沟通内容",value:o,code:"communicationInfo",showFlag:!0},{name:"沟通方式",value:a,code:"communicationWay",showFlag:!0},{name:"聊天记录",value:i,code:"phoneRecordingVo",showFlag:!1},{name:"沟通凭证",value:l,code:"resourceList",showFlag:!0}]),"phone"===a&&f.forEach((function(e){"phoneRecordingVo"===e.code&&(e.showFlag=!0)}));var h="";0===m?h="INSPECTION_RESULT":1===m&&(h="INSPECTION_FEED_BACK");var b=p(h);b.forEach((function(e){f.push({name:e.name,value:t[e.code],showFlag:!0})})),f=f.filter((function(e){return e.showFlag})),e.push({name:"",status:u,dataSource:f})})),e}return o=o||[],n=n||{},s=s||{},l=l||[],m=m||[],{findCustomField:p,getJobInfo:h,getHistory:b,getHistoryZhijian:g}}var G=o("ae84"),X=o("d6e8"),K={components:{timeline:m["a"],statusBar:l["a"],SectionTemplate:u["a"],DrawerFooter:d["a"],cantEditInfo:f["a"],kesuBaseifoForm:R,kesuForm:k,kesuFenleiForm:q,OrderDrawer:G["default"],drawerEmpty:X["a"]},props:{dataSource:{type:Object,default:function(){return{}},required:!0},visible:{type:Boolean,required:!1,default:!1}},data:function(){return{jobStatus:null,operateStatus:null,handleHistory:!0,recentHistory:{},history:null,cantEditBaseInfoData:[],cantEditTypeData:[{name:"投诉来源",value:""},{name:"投诉归类",value:""}],baseJobInfo:{},baseJobform:{},allotType:null,classifyData:{},resultInfo:{},classifyFormData:{},resultInfoForm:{},loading:!1,editOption:!1,followUp:!1,compensa:!1,ordertype:"",isHistoryShow:!1,wxIframeSrc:"",saveLoading:!1}},computed:Object(i["a"])({},Object(C["mapGetters"])(["currentJobInfo","currentStudentInfo"])),methods:{getOrder:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){var o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return o=e.currentJobInfo.jobInfo.studentOrderStreamId||e.dataSource.studentOrderStreamId,t.next=3,Object(v["c"])({streamId:o}).then((function(t){var o=!1;return!t||200!==t.code||"1"!==t.data&&"2"!==t.data?o=!0:e.$toast("订单已删除，无法查看！"),o})).then((function(t){t&&Object(D["o"])({studentOrderStreamId:o}).then((function(t){t&&200===t.code&&e.todetail(t.data)}))}));case 3:case"end":return t.stop()}}),t)})))()},todetail:function(e){var t=this,o=this.currentJobInfo.jobInfo||{},a=o.studentId;"CRM"===e.busType?(sessionStorage.setItem("notframe","yes"),sessionStorage.setItem("trackId",e.trackId),sessionStorage.setItem("customerId",e.customerId),sessionStorage.setItem("trackType",e.trackType),sessionStorage.setItem("commonTrackId",e.trackId),this.ordertype=4,this.compensa=!0,this.loading=!1):Object(v["e"])({stuId:a}).then((function(o){if(o&&200===o.code){if(!o.data.schoolToken)return t.$toast("网校token获取失败"),!1;var a=o.data.schoolToken||{},n=o.data.schoolManageUrl||"";t.selectedRowData=e,t.$refs.drawerEmpty.visible=!0,t.wxIframeSrc="".concat(n,"/s/ad/#/crmpage/orderdetail?orderType=").concat("COMMODITY_MIX"===e.orderType?"2":"1","&orderId=").concat(e.orderId,"&crmtoken=").concat(a.accessToken,"&wxtoken=").concat(a["x-auth-token"],"&a=")+(new Date-0)}t.loading=!1}))},closecompensation:function(){this.compensa=!1},wxiframeLoad:function(){var e=document.getElementById("wxDrawerIframeRigth");e.contentWindow.postMessage({type:"orderRowData",oprate:"订单数据",data:this.selectedRowData},"*")},handleToggle:function(){this.collapse=!this.collapse},continuehandle:function(){this.operateStatus="CONDUCT_HANDLER"},handleSubmit:function(){var e=this.baseJobform.allotType,t={},o={};if(this.editOption&&"WAIT_ALLOCATION"===this.jobStatus||!this.operateStatus){if(!this.$refs.baseinfoForm.validateForm())return!1;t=JSON.parse(JSON.stringify(this.baseJobform)),delete t.allotType,t&&t.complaintDate&&(t.complaintDate=c()(t.complaintDate).format("YYYY-MM-DD"))}if((1===e||"创建"!==this.dataSource.tabName)&&"待分配"!==this.dataSource.tabName){if(!this.$refs.classifyForm.validateForm()||!this.$refs.resultInfoForm.validateForm())return!1;o=JSON.parse(JSON.stringify(this.resultInfoForm)),o&&o.nextPlanTime&&(o.nextPlanTime=c()(o.nextPlanTime).format("YYYY-MM-DD HH:mm:ss"))}t&&t.communicationProof&&delete t.communicationProof,this.saveInsertJobInfo(e,t,o)},onClose:function(e){this.baseJobform={},this.resultInfoForm={},this.classifyFormData={},this.$emit("closeDrawer",!(!e&&1!==e))},saveInsertJobInfo:function(e,t,o){var a=this,n={type:"CUSTOMER_COMPLAINT",studentOrderStreamId:this.dataSource.studentOrderStreamId,jobId:this.dataSource.jobId,allotType:e,processor:2===e?t.processor:void 0,complaintParam:{complaintAscription:this.classifyFormData.complaintAscription?this.classifyFormData.complaintAscription:"",complaintInfoParam:t,complaintResultParam:o,complaintSource:this.classifyFormData.complaintSource?this.classifyFormData.complaintSource:""}};this.saveLoading=!0,this.editOption&&"WAIT_ALLOCATION"===this.jobStatus?Object(D["x"])(n).then((function(e){a.saveLoading=!1,200===e.code?(a.$message.success("保存成功"),a.onClose(1)):a.$message.error(e.msg)})):Object(D["t"])(n).then((function(e){a.saveLoading=!1,200===e.code?(a.$message.success("保存成功"),a.onClose(1)):a.$message.error(e.msg)}))},getJobModelConfig:function(){var e=this;this.loading=!0,Object(D["k"])({type:"CUSTOMER_COMPLAINT",jobId:this.dataSource.jobId,studentOrderStreamId:this.dataSource.studentOrderStreamId}).then((function(t){if(e.loading=!1,200===t.code){var o=JSON.parse(JSON.stringify(Object(i["a"])(Object(i["a"])({},t.data),{},{encryptFileds:t.encryptFileds})));e.$store.commit("SAVECURRENTJOBINFO",Object(i["a"])(Object(i["a"])({studentOrderStreamId:e.dataSource.id},t.data),{},{studentId:e.dataSource.studentId,encryptFileds:t.encryptFileds})),e.initData(o)}}))},initData:function(e){var t=this;if(this.operateStatus=e.operateStatus,this.jobStatus=e.status,this.baseJobInfo=JSON.parse(JSON.stringify(Object(i["a"])(Object(i["a"])({},e.jobInfo),{},{encryptFileds:e.encryptFileds}))),this.resultInfo=JSON.parse(JSON.stringify(e.jobInfo)),this.dataSource.jobId&&(this.cantEditBaseInfoData=z(e).getJobInfo()),this.editOption=e.jobAuthority.edit,this.followUp=e.jobAuthority.followUp,this.editOption&&e.jobModelComplaintVo)for(var o in e.jobModelComplaintVo)e.jobModelComplaintVo[o]&&function(){"complaintDate"===o&&e.jobModelComplaintVo[o]&&(e.jobModelComplaintVo[o]=c()(e.jobModelComplaintVo[o],"YYYY-MM-DD"));var a=[];"resourceList"===o&&e.jobModelComplaintVo[o]&&e.jobModelComplaintVo[o].length>0&&(e.jobModelComplaintVo[o].forEach((function(e,t){a.push({uid:t,name:e.name,url:"https://image.yunduoketang.com/".concat(e.url),item:"".concat(e.url),status:"done"})})),t.$set(t.baseJobform,"communicationProof",a)),t.$set(t.baseJobform,o,e.jobModelComplaintVo[o])}();this.baseJobInfo.studentId||this.$set(this.baseJobInfo,"studentId",this.dataSource.studentId);var a=z(e).findCustomField("JOB_INFO"),n=z(e).findCustomField("CUSTOMER_COMPLAINT_RESULT");this.$set(this.baseJobInfo,"JobInfoArr",a),this.$set(this.resultInfo,"JobInfoArr",n),e.jobModelFieldConfigVoList.forEach((function(e){"complaintSource"===e.code?(t.$set(t.classifyData,"complaintSource",JSON.parse(e.value)),t.$set(t.classifyFormData,"complaintSource",e.defaultValue)):"complaintAscription"===e.code&&(t.$set(t.classifyData,"complaintAscription",JSON.parse(e.value)),t.$set(t.classifyFormData,"complaintAscription",e.defaultValue))}));var r=e.jobModelComplaintVo&&e.jobModelComplaintVo.jobModelComplaintResultVoList;if(r&&r.length>0){var s=r[r.length-1].complaintSource,l=r[r.length-1].complaintAscription;this.$set(this.classifyFormData,"complaintSource",s),this.$set(this.classifyFormData,"complaintAscription",l),this.classifyData.complaintSource.forEach((function(e){e.value===s&&(t.cantEditTypeData[0].value=e.text)})),this.classifyData.complaintAscription.forEach((function(e){e.value===l&&(t.cantEditTypeData[1].value=e.text)}))}this.history=z(e).getHistory("CUSTOMER_COMPLAINT_RESULT")},historyUpDown:function(){this.isHistoryShow=!this.isHistoryShow}},watch:{dataSource:function(e){this.getJobModelConfig()},visible:{handler:function(e){this.isHistoryShow=!1},immediate:!0}},mounted:function(){this.getJobModelConfig()}},Z=K,Q=(o("f634"),Object(T["a"])(Z,a,n,!1,null,"5d04b42c",null));t["a"]=Q.exports},"96ae":function(e,t,o){},"9d12":function(e,t,o){"use strict";o("2a4c")},b960:function(e,t,o){"use strict";o("24c0")},f634:function(e,t,o){"use strict";o("96ae")}}]);